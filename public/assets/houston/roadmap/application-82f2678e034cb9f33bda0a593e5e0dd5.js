(function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/milestone"]=Handlebars.template({1:function(t,e,n,a){var s,i,r,o="function",l=e.helperMissing,d=e.blockHelperMissing,p='<table class="table table-milestone-tickets">\n  <thead>\n    <tr>\n      <td></td>\n      <th class="ticket-number">#</th>\n      <th class="ticket-summary">Summary</th>\n      <th class="ticket-effort">Effort</th>\n      <th class="ticket-status">Status</th>\n      <td></td>\n    </tr>\n  </thead>\n  <tbody id="tickets">\n    ';return i=null!=(i=e.tickets||(null!=t?t.tickets:t))?i:l,r={name:"tickets",hash:{},fn:this.program(2,a),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.tickets||(s=d.call(t,s,r)),null!=s&&(p+=s),p+"\n  </tbody>\n</table>\n"},2:function(t,e,n,a){var s;return s=this.invokePartial(n.milestoneTicket,"","milestoneTicket",t,void 0,e,n,a),null!=s?s:""},4:function(){return'<div class="alert alert-info">There are no tickets in this milestone.</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i='<div id="graph" class="burndown-chart callout callout-banner"></div>\n\n<div class="score score-medium milestone-progress">\n  <p class="positive">\n    <span class="score-count" id="milestone_progress"></span>\n    <span class="score-label">Complete</span>\n  </p>\n</div>\n\n<h2 class="light">Tickets</h2>\n\n<a class="btn" id="show_completed_tickets" data-toggle="button">Show Completed Tickets</a>\n\n<div id="find_or_create_ticket_view"></div>\n\n<hr />\n\n';return s=e["if"].call(t,null!=t?t.tickets:t,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(4,a),data:a}),null!=s&&(i+=s),i},usePartial:!0,useData:!0}),this.HandlebarsTemplates["houston/roadmap/milestone"]}).call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/milestone/ticket"]=Handlebars.template({1:function(){return"ticket-released"},3:function(){return"ticket-resolved"},5:function(){return"ticket-closed"},7:function(t,e,n,a){var s,i="function",r=e.helperMissing,o=this.escapeExpression;return'      <span class="ticket-tag" style="background-color: #'+o((s=null!=(s=e.color||(null!=t?t.color:t))?s:r,typeof s===i?s.call(t,{name:"color",hash:{},data:a}):s))+'">'+o((s=null!=(s=e.name||(null!=t?t.name:t))?s:r,typeof s===i?s.call(t,{name:"name",hash:{},data:a}):s))+"</span>\n"},9:function(){return'      <i class="fa fa-ban"></i> Closed\n    '},11:function(t,e,n,a){var s;return s=e["if"].call(t,null!=t?t.firstReleaseAt:t,{name:"if",hash:{},fn:this.program(12,a),inverse:this.program(14,a),data:a}),null!=s?s:""},12:function(){return'\n      <i class="fa fa-paper-plane"></i> Released\n'},14:function(){return'      <i class="fa fa-circle-o"></i> Open\n    '},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i,r,o="function",l=e.helperMissing,d=this.escapeExpression,p=e.blockHelperMissing,c='<tr id="ticket_'+d((i=null!=(i=e.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:a}):i))+'" class="ticket ';return i=null!=(i=e.firstReleaseAt||(null!=t?t.firstReleaseAt:t))?i:l,r={name:"firstReleaseAt",hash:{},fn:this.program(1,a),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.firstReleaseAt||(s=p.call(t,s,r)),null!=s&&(c+=s),c+=" ",i=null!=(i=e.resolved||(null!=t?t.resolved:t))?i:l,r={name:"resolved",hash:{},fn:this.program(3,a),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.resolved||(s=p.call(t,s,r)),null!=s&&(c+=s),c+=" ",i=null!=(i=e.closedAt||(null!=t?t.closedAt:t))?i:l,r={name:"closedAt",hash:{},fn:this.program(5,a),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.closedAt||(s=p.call(t,s,r)),null!=s&&(c+=s),c+='" rel="ticket" data-number="'+d((i=null!=(i=e.number||(null!=t?t.number:t))?i:l,typeof i===o?i.call(t,{name:"number",hash:{},data:a}):i))+'" data-id="'+d((i=null!=(i=e.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:a}):i))+'">\n  <td class="ticket-handle"></td>\n  <td class="ticket-number">#'+d((i=null!=(i=e.number||(null!=t?t.number:t))?i:l,typeof i===o?i.call(t,{name:"number",hash:{},data:a}):i))+'</td>\n  <td class="ticket-summary">\n    '+d((i=null!=(i=e.summary||(null!=t?t.summary:t))?i:l,typeof i===o?i.call(t,{name:"summary",hash:{},data:a}):i))+"\n",i=null!=(i=e.tags||(null!=t?t.tags:t))?i:l,r={name:"tags",hash:{},fn:this.program(7,a),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.tags||(s=p.call(t,s,r)),null!=s&&(c+=s),c+='  </td>\n  <td class="ticket-effort">\n    '+d((i=null!=(i=e.estimatedEffort||(null!=t?t.estimatedEffort:t))?i:l,typeof i===o?i.call(t,{name:"estimatedEffort",hash:{},data:a}):i))+'\n  </td>\n  <td class="ticket-status">\n',s=e["if"].call(t,null!=t?t.closedAt:t,{name:"if",hash:{},fn:this.program(9,a),inverse:this.program(11,a),data:a}),null!=s&&(c+=s),c+'\n  </td>\n  <td class="ticket-remove">\n    <a class="remove-ticket-button remove-button"></a>\n  </td>\n</tr>'},useData:!0}),this.HandlebarsTemplates["houston/roadmap/milestone/ticket"]}.call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/milestones/edit"]=Handlebars.template({1:function(){return""},3:function(){return"zero"},5:function(t,e,n,a){var s,i="function",r=e.helperMissing,o=this.escapeExpression;return o((s=null!=(s=e.ticketsCompleted||(null!=t?t.ticketsCompleted:t))?s:r,typeof s===i?s.call(t,{name:"ticketsCompleted",hash:{},data:a}):s))+"/"},7:function(){return"checked"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i,r="function",o=e.helperMissing,l=this.escapeExpression,d='<td class="milestone-name"><input type="text" name="name" value="'+l((i=null!=(i=e.name||(null!=t?t.name:t))?i:o,typeof i===r?i.call(t,{name:"name",hash:{},data:a}):i))+'" autofocus /></td>\n<td class="milestone-startDate date">';return s=(e.formatDateWithYear||t&&t.formatDateWithYear||o).call(t,null!=t?t.startDate:t,{name:"formatDateWithYear",hash:{},data:a}),null!=s&&(d+=s),d+='</td>\n<td class="milestone-duration">'+l((e.durationOfMilestone||t&&t.durationOfMilestone||o).call(t,t,{name:"durationOfMilestone",hash:{},data:a}))+'</td>\n<td class="milestone-lanes">'+l((i=null!=(i=e.lanes||(null!=t?t.lanes:t))?i:o,typeof i===r?i.call(t,{name:"lanes",hash:{},data:a}):i))+'</td>\n<td class="milestone-tickets ',s=e["if"].call(t,null!=t?t.tickets:t,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(3,a),data:a}),null!=s&&(d+=s),d+='">\n  ',s=e["if"].call(t,null!=t?t.ticketsCompleted:t,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+=l((i=null!=(i=e.tickets||(null!=t?t.tickets:t))?i:o,typeof i===r?i.call(t,{name:"tickets",hash:{},data:a}):i))+'\n</td>\n<td class="milestone-completion">'+l((e.milestonePercentComplete||t&&t.milestonePercentComplete||o).call(t,t,{name:"milestonePercentComplete",hash:{},data:a}))+'</td>\n<td class="milestone-locked">\n  <input type="hidden" name="locked" value="0" />\n  <input type="checkbox" name="locked" value="1" ',s=e["if"].call(t,null!=t?t.locked:t,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+" />\n</td>"},useData:!0}),this.HandlebarsTemplates["houston/roadmap/milestones/edit"]}.call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/milestones/index"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="roadmap" class="roadmap callout callout-banner"></div>\n\n<h2 class="light">Milestones</h2>\n\n<span class="buttons" style="float: right;">\n  <button id="reset_roadmap" class="btn">Reset</button>\n  <button id="save_roadmap" class="btn btn-primary">Save</button>\n</span>\n\n<a class="btn" id="show_completed_milestones" data-toggle="button">Show Completed Milestones</a>\n\n<hr/>\n\n<div id="milestones_view">\n  <form class="freight_train" data-model="Milestone">\n    <table class="table table-roadmap-milestones">\n      <thead>\n        <th class="milestone-name">Name</th>\n        <th class="milestone-startDate">Starts</th>\n        <th class="milestone-duration">Duration</th>\n        <th class="milestone-lanes">Lanes</th>\n        <th class="milestone-tickets">Tickets</th>\n        <th class="milestone-completion">Completed</th>\n        <th class="milestone-locked">Locked</th>\n      </thead>\n      <tbody id="milestones"></tbody>\n    </table>\n  </form>\n</div>'},useData:!0}),this.HandlebarsTemplates["houston/roadmap/milestones/index"]}.call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/milestones/show"]=Handlebars.template({1:function(){return""},3:function(){return"zero"},5:function(t,e,n,a){var s,i="function",r=e.helperMissing,o=this.escapeExpression;return o((s=null!=(s=e.ticketsCompleted||(null!=t?t.ticketsCompleted:t))?s:r,typeof s===i?s.call(t,{name:"ticketsCompleted",hash:{},data:a}):s))+"/"},7:function(){return'    <i class="fa fa-lock"></i>\n'},9:function(){return'    <i class="fa fa-unlock-alt"></i>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i,r="function",o=e.helperMissing,l=this.escapeExpression,d='<td class="milestone-name"><a href="/roadmap/milestones/'+l((i=null!=(i=e.id||(null!=t?t.id:t))?i:o,typeof i===r?i.call(t,{name:"id",hash:{},data:a}):i))+'">'+l((i=null!=(i=e.name||(null!=t?t.name:t))?i:o,typeof i===r?i.call(t,{name:"name",hash:{},data:a}):i))+'</a></td>\n<td class="milestone-startDate date">';return s=(e.formatDateWithYear||t&&t.formatDateWithYear||o).call(t,null!=t?t.startDate:t,{name:"formatDateWithYear",hash:{},data:a}),null!=s&&(d+=s),d+='</td>\n<td class="milestone-duration">'+l((e.durationOfMilestone||t&&t.durationOfMilestone||o).call(t,t,{name:"durationOfMilestone",hash:{},data:a}))+'</td>\n<td class="milestone-lanes">'+l((i=null!=(i=e.lanes||(null!=t?t.lanes:t))?i:o,typeof i===r?i.call(t,{name:"lanes",hash:{},data:a}):i))+'</td>\n<td class="milestone-tickets ',s=e["if"].call(t,null!=t?t.tickets:t,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(3,a),data:a}),null!=s&&(d+=s),d+='">\n  ',s=e["if"].call(t,null!=t?t.ticketsCompleted:t,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+=l((i=null!=(i=e.tickets||(null!=t?t.tickets:t))?i:o,typeof i===r?i.call(t,{name:"tickets",hash:{},data:a}):i))+'\n</td>\n<td class="milestone-completion">'+l((e.milestonePercentComplete||t&&t.milestonePercentComplete||o).call(t,t,{name:"milestonePercentComplete",hash:{},data:a}))+'</td>\n<td class="milestone-locked">\n',s=e["if"].call(t,null!=t?t.locked:t,{name:"if",hash:{},fn:this.program(7,a),inverse:this.program(9,a),data:a}),null!=s&&(d+=s),d+"</td>"},useData:!0}),this.HandlebarsTemplates["houston/roadmap/milestones/show"]}.call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/roadmap/show"]=Handlebars.template({1:function(t,e,n,a){var s,i,r="function",o=e.helperMissing,l=this.escapeExpression,d='      <tr class="milestone inactive ';return s=e["if"].call(t,null!=t?t.locked:t,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+=" ",s=e["if"].call(t,null!=t?t.completed:t,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+='">\n        <td class="milestone-name"><a href="/roadmap/milestones/'+l((i=null!=(i=e.id||(null!=t?t.id:t))?i:o,typeof i===r?i.call(t,{name:"id",hash:{},data:a}):i))+'">'+l((i=null!=(i=e.name||(null!=t?t.name:t))?i:o,typeof i===r?i.call(t,{name:"name",hash:{},data:a}):i))+'</a></td>\n        <td class="milestone-startDate date">',s=(e.formatDateWithYear||t&&t.formatDateWithYear||o).call(t,null!=t?t.startDate:t,{name:"formatDateWithYear",hash:{},data:a}),null!=s&&(d+=s),d+='</td>\n        <td class="milestone-duration">'+l((e.durationOfMilestone||t&&t.durationOfMilestone||o).call(t,t,{name:"durationOfMilestone",hash:{},data:a}))+'</td>\n        <td class="milestone-lanes">'+l((i=null!=(i=e.lanes||(null!=t?t.lanes:t))?i:o,typeof i===r?i.call(t,{name:"lanes",hash:{},data:a}):i))+'</td>\n        <td class="milestone-tickets ',s=e["if"].call(t,null!=t?t.tickets:t,{name:"if",hash:{},fn:this.program(6,a),inverse:this.program(8,a),data:a}),null!=s&&(d+=s),d+='">\n          ',s=e["if"].call(t,null!=t?t.ticketsCompleted:t,{name:"if",hash:{},fn:this.program(10,a),inverse:this.noop,data:a}),null!=s&&(d+=s),d+=l((i=null!=(i=e.tickets||(null!=t?t.tickets:t))?i:o,typeof i===r?i.call(t,{name:"tickets",hash:{},data:a}):i))+'\n        </td>\n        <td class="milestone-completion">'+l((e.milestonePercentComplete||t&&t.milestonePercentComplete||o).call(t,t,{name:"milestonePercentComplete",hash:{},data:a}))+'</td>\n        <td class="milestone-locked">\n',s=e["if"].call(t,null!=t?t.locked:t,{name:"if",hash:{},fn:this.program(12,a),inverse:this.program(14,a),data:a}),null!=s&&(d+=s),d+"        </td>\n      </tr>\n"},2:function(){return"locked"},4:function(){return"completed"},6:function(){return""},8:function(){return"zero"},10:function(t,e,n,a){var s,i="function",r=e.helperMissing,o=this.escapeExpression;return o((s=null!=(s=e.ticketsCompleted||(null!=t?t.ticketsCompleted:t))?s:r,typeof s===i?s.call(t,{name:"ticketsCompleted",hash:{},data:a}):s))+"/"},12:function(){return'            <i class="fa fa-lock"></i>\n'},14:function(){return'            <i class="fa fa-unlock-alt"></i>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i='<div id="roadmap" class="roadmap callout callout-banner"></div>\n\n<h2 class="light">Milestones</h2>\n\n<a class="btn" id="show_completed_milestones" data-toggle="button">Show Completed Milestones</a>\n\n<hr/>\n\n<div id="milestones_view">\n  <table class="table table-roadmap-milestones">\n    <thead>\n      <th class="milestone-name">Name</th>\n      <th class="milestone-startDate">Starts</th>\n      <th class="milestone-duration">Duration</th>\n      <th class="milestone-lanes">Lanes</th>\n      <th class="milestone-tickets">Tickets</th>\n      <th class="milestone-completion">Completed</th>\n      <th class="milestone-locked">Locked</th>\n    </thead>\n    <tbody id="milestones">\n';return s=e.each.call(t,null!=t?t.milestones:t,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}),null!=s&&(i+=s),i+"    </tbody>\n  </table>\n</div>"},useData:!0}),this.HandlebarsTemplates["houston/roadmap/show"]}.call(this),function(){window.Roadmap={},window.Neat.template=HandlebarsTemplates}.call(this),function(){Handlebars.registerPartial("milestoneTicket",function(t){return HandlebarsTemplates["houston/roadmap/milestone/ticket"](t)}),Handlebars.registerHelper("durationOfMilestone",function(t){var e,n;return t.endDate&&t.startDate?(e=t.endDate-t.startDate,n=Math.round(e/Duration.WEEK),""+n+" weeks"):""}),Handlebars.registerHelper("milestonePercentComplete",function(t){return null==t.percentComplete?"":App.formatPercent(t.percentComplete)})}.call(this),function(){$.fn.extend({pluck:function(){return _.map(this,function(t){return $(t).attr("data-id")})}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.Milestone=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="/roadmap/milestones",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),_.bindAll(this,"clearChangesSinceSave","revert"),this.clearChangesSinceSave()},n.prototype.save=function(t,e){var a;return a=null!=e?e.success:void 0,e.success=function(t){return function(e){return t.trigger("save:success",t),a&&a(t,e),t.clearChangesSinceSave()}}(this),this.trigger("save",this),n.__super__.save.apply(this,arguments)},n.prototype.duration=function(){return Math.floor((this.get("endDate")-this.get("startDate"))/Duration.DAY).days()},n.prototype.clearChangesSinceSave=function(){return this._originalAttributes=_.clone(this.attributes)},n.prototype.revert=function(){return this._originalAttributes?this.set(this._originalAttributes):void 0},n.prototype.changesSinceSave=function(){var t,e,n,a,s;e={},s=this.attributes;for(t in s)a=s[t],n=this._originalAttributes[t],_.isEqual(n,a)||(e[t]=[n,a]);return e},n.prototype.parse=function(t){return t.startDate&&(t.startDate=App.serverDateFormat.parse(t.startDate)),t.endDate&&(t.endDate=App.serverDateFormat.parse(t.endDate)),t},n.prototype.toJSON=function(t){var e;return e=n.__super__.toJSON.call(this,t),e.cid=this.cid,"emulateHTTP"in(t||{})&&(e.startDate&&(e.start_date=App.serverDateFormat(e.startDate)),delete e.startDate,e.endDate&&(e.end_date=App.serverDateFormat(e.endDate)),delete e.endDate),e},n}(Backbone.Model),Roadmap.Milestones=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Roadmap.Milestone,n.prototype.start=function(){return _.min(this.pluck("startDate"))},n.prototype.end=function(){return _.max(this.pluck("endDate"))},n.prototype.revert=function(){var t,e,n;for(t=0,n=[];t<this.length;)e=this.models[t],e.get("id")?(e.revert(),n.push(t++)):n.push(this.remove(e));return n},n.prototype.changes=function(){var t,e,n,a,s,i,r,o,l,d,p,c,u;for(l=this.models,u=[],r=0,o=l.length;o>r;r++)if(a=l[r],!a.id||_.keys(n=a.changesSinceSave()).length>0)if(a.id){e={id:a.id};for(t in n)d=n[t],i=d[0],s=d[1],"startDate"===t&&(p=["start_date",App.serverDateFormat(s)],t=p[0],s=p[1]),"endDate"===t&&(c=["end_date",App.serverDateFormat(s)],t=c[0],s=c[1]),e[t]=s;u.push(e)}else u.push(a.toJSON({emulateHTTP:!0}));return u},n}(Backbone.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.Viewport=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.domain=function(){return[this.get("start"),this.get("end")]},n}(Backbone.Model)}.call(this),function(){Roadmap.RoadmapView=function(){function t(t,e){var n,a,s,i,r,o;this.milestones=t,null==e&&(e={}),this.showToday=null!=(n=e.showToday)?n:!0,this.showThumbnail=null!=(a=e.showThumbnail)?a:!0,this.showWeekends=null!=(s=e.showWeekends)?s:!1,this.linkMilestones=null!=(i=e.linkMilestones)?i:!1,this.showProgress=null!=(r=e.showProgress)?r:!1,this.viewport=null!=(o=e.viewport)?o:this.defaultViewport(),this.viewport.bind("change",this.updateViewport,this),this.height=24,this.milestones.bind("add",this.update,this),this.milestones.bind("change",this.update,this),this.milestones.bind("remove",this.update,this),this.milestones.bind("reset",this.reset,this),$(window).resize(function(t){return function(e){return e.target===window?t.updateWindow():void 0}}(this))}return t.prototype.today=new Date,t.prototype.defaultViewport=function(){return new Roadmap.Viewport({start:3..weeks().before(this.today),end:6..months().after(3..weeks().before(this.today))})},t.prototype.render=function(){var t;return this.$el=$("#roadmap"),this.showThumbnail&&(this.thumbnail=new Roadmap.ThumbnailRoadmapView({milestones:this.milestones,viewport:this.viewport,parent:d3.select("#roadmap")}),this.thumbnail.render()),this.roadmap=d3.select("#roadmap").append("div").attr("class","roadmap-bands"),t=this.roadmap.append("svg").attr("height",this.height).attr("class","roadmap-axis").append("g").attr("transform","translate(0,0)"),this.xAxis=t.append("g").attr("class","x axis"),this.updateWindow()},t.prototype.reset=function(){return window.setTimeout(_.bind(this.updateViewport,this))},t.prototype.updateWindow=function(){var t,e;return e=this.$el.width()||960,this.width!==e?(this.width=e,this.roadmap.select("svg").transition(150).attr("width",this.width),this.x=d3.time.scale().domain(this.viewport.domain()).range([0,this.width]),t=d3.svg.axis().scale(this.x).orient("bottom"),this.xAxis.transition(150).call(t),this.update({transition:!0})):void 0},t.prototype.updateViewport=function(){var t;return this.x=d3.time.scale().domain(this.viewport.domain()).range([0,this.width]),t=d3.svg.axis().scale(this.x).orient("bottom"),this.xAxis.call(t),this.update({transition:!1})},t.prototype.update=function(t){var e,n,a,s,i,r,o,l,d,p;return i=null!=(d=null!=t?t.transition:void 0)?d:!0,o=this,this.today=new Date,e=this.roadmap.selectAll(".roadmap-band").data(this.groupMilestonesIntoBands(),function(t){return t.key}),e.enter().append("div").attr("class",function(t){return"roadmap-band "+t.color}).attr("data-band",function(t){return t.number}).each(function(){return o.initializeBand.apply(o,[this])}),e.exit().remove(),this.showWeekends&&(l=this.roadmap.selectAll(".roadmap-weekend").data((p=d3.time).saturdays.apply(p,this.x.domain()),function(t){return t}),l.enter().append("div").attr("class","roadmap-weekend").attr("style",function(t){return function(e){return"left: "+t.x(e)+"px; width: "+(t.x(2..days().after(e))-t.x(e))+"px;"}}(this)),r=i?l.transition(150):l,r.attr("style",function(t){return function(e){return"left: "+t.x(e)+"px; width: "+(t.x(2..days().after(e))-t.x(e))+"px;"}}(this)),l.exit().remove()),n=e.selectAll(".roadmap-milestone").data(function(t){return t.milestones},function(t){return t.cid}),a=this.linkMilestones?n.enter().append("a").attr("href",function(t){return"/roadmap/milestones/"+t.id}):n.enter().append("div"),this.showProgress&&a.append("div").attr("class","roadmap-milestone-progress"),a.attr("style",function(t){return function(e){return["left: "+t.x(e.startDate)+"px","width: "+(t.x(e.endDate)-t.x(e.startDate))+"px","height: "+(38*e.lanes-8)+"px"].join("; ")}}(this)).attr("class","roadmap-milestone").attr("data-cid",function(t){return t.cid}).each(function(){return o.initializeMilestone.apply(o,[this])}).append("span").text(function(t){return t.name}),r=i?n.transition(150):n,r.attr("class",function(t){return function(e){var n;return n=["roadmap-milestone"],n.push(e.locked?"locked":"unlocked"),n.push(e.completed?"completed":"uncompleted"),n.push(e.startDate>t.today?"upcoming":e.endDate<t.today?"past":"active"),n.join(" ")}}(this)).attr("style",function(t){return function(e){return["left: "+t.x(e.startDate)+"px","width: "+(t.x(e.endDate)-t.x(e.startDate))+"px","height: "+(38*e.lanes-8)+"px"].join("; ")}}(this)).select(".roadmap-milestone-progress").attr("style",function(t){return 0===t.tickets?"width: 0":"width: "+100*t.percentComplete+"%"}),n.exit().remove(),this.showToday?(s=this.roadmap.selectAll(".roadmap-today").data([this.today]),s.enter().append("div").attr("class","roadmap-today").attr("style",function(t){return function(e){return"left: "+t.x(e)+"px;"}}(this)),r=i?s.transition(150):s,r.attr("style",function(t){return function(e){return"left: "+t.x(e)+"px;"}}(this))):void 0},t.prototype.groupMilestonesIntoBands=function(){var t,e,n,a,s,i;for(n={},a=function(){var t,n,a,s;for(a=this.milestones.models,s=[],t=0,n=a.length;n>t;t++)e=a[t],s.push(this.toJSON(e));return s}.call(this),s=0,i=a.length;i>s;s++)e=a[s],e.startDate&&e.endDate&&(t=""+e.projectId+"-"+e.band,(n[t]||(n[t]={key:t,projectId:e.projectId,color:e.projectColor,number:e.band,milestones:[]})).milestones.push(e));return _.values(n)},t.prototype.toJSON=function(t){var e;return e=t.toJSON(),e.cid=t.cid,e},t.prototype.initializeBand=function(){},t.prototype.initializeMilestone=function(){},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.EditMilestoneView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.supportsSorting=!1,n.prototype.className="hide-completed",n.prototype.events={"click .remove-button":"removeTicket","click #show_completed_tickets":"toggleShowCompleted"},n.prototype.initialize=function(){return this.id=this.options.id,this.template=HandlebarsTemplates["houston/roadmap/milestone"],this.openTickets=this.options.openTickets,this.projectTicketTracker=this.options.projectTicketTracker,n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){var t,e,n,a,s;return s=function(){var t,e,s,i;for(s=this.tickets.models,i=[],t=0,e=s.length;e>t;t++)a=s[t],n=a.toJSON(),n.estimatedEffort=a.estimatedEffort(),i.push(n);return i}.call(this),e=this.template({tickets:s}),this.$el.html(e),this.newTicketView=new FindOrCreateTicketView({ticketTracker:this.projectTicketTracker,tickets:this.openTickets,addTicket:_.bind(this.addTicket,this),createTicket:_.bind(this.createTicket,this)}),this.$el.find("#find_or_create_ticket_view").appendView(this.newTicketView),t=_.select(s,function(t){return!!t.closedAt}).length/s.length,_.isNaN(t)?$(".milestone-progress").hide():($("#milestone_progress").html(App.formatPercent(t)),$(".milestone-progress").show()),this.renderBurndownChart(this.tickets.models),$("#tickets").sortable({handle:".ticket-handle",helper:function(t,e){return e.children().each(function(){return $(this).width($(this).width())}),e},stop:function(t,e){return e.item.children().css("width","")},update:function(){var t,e;return t=$("#tickets .ticket"),e=_.map(t,function(t){return+$(t).attr("data-id")}),$.put(""+window.location.pathname+"/ticket_order",{order:e})}}),this},n.prototype.addTicket=function(t){return $.post("/roadmap/milestones/"+this.id+"/tickets/"+t.id).success(function(e){return function(){return e._addTicket(t)}}(this))},n.prototype.createTicket=function(t){return $.post("/roadmap/milestones/"+this.id+"/tickets",{summary:t}).success(function(t){return function(e){return t._addTicket(e)}}(this))},n.prototype._addTicket=function(t){return this.tickets.get(t.id)||(this.tickets.push(new Ticket(t)),this.rerenderTickets(),this.renderBurndownChart(this.tickets.models)),$(".ticket[data-id="+t.id+"]").highlight()},n.prototype.rerenderTickets=function(){var t,e,n,a,s,i,r,o;if(n=HandlebarsTemplates["houston/roadmap/milestone/ticket"],t=this.$el.find("#tickets"),0===t.length)return this.render();for(t.empty(),r=this.tickets.models,o=[],s=0,i=r.length;i>s;s++)a=r[s],e=a.toJSON(),e.estimatedEffort=a.estimatedEffort(),o.push(t.append(n(e)));return o},n.prototype.removeTicket=function(t){var e,n,a;return t.preventDefault(),t.stopImmediatePropagation(),e=$(t.target),e.prop("disabled",!0),n=e.closest(".ticket"),n.addClass("deleting"),a=+n.attr("data-id"),$.destroy("/roadmap/milestones/"+this.id+"/tickets/"+a).error(function(){return function(){return e.prop("disabled",!1),n.removeClass("deleting")}}(this)).success(function(t){return function(){return t.tickets.remove(t.tickets.get(a)),n.remove()}}(this))},n.prototype.renderBurndownChart=function(t){var e,n,a,s,i,r,o,l,d,p,c,u,h,m,f,g,v,y,w,b,k,x,D,C,$,M,T,S;for(h={},C=0,u=0,M=0,T=t.length;T>M;M++)D=t[M],i=+D.estimatedEffort(),i&&D.get("firstReleaseAt")&&(r=App.parseDate(D.get("firstReleaseAt")),r>u&&(u=+r),b=this.getEndOfSprint(r),h[b]=(h[b]||0)+i),C+=i;for(S=d3.extent(function(){var t,e,n,a;for(n=_.keys(h),a=[],t=0,e=n.length;e>t;t++)s=n[t],a.push(+s);return a}()),o=S[0],p=S[1],o=this.prevSprint(o),w=C,b=o,a=[];p>=b;)w-=h[b]||0,a.push({day:new Date(b),effort:Math.ceil(w)}),b=this.nextSprint(b);if(d=this.getEndOfSprint(1..week().before(new Date)),this.truncateDate(u)>d?(a.length>=6&&(g=this.computeRegression(a.slice(0,-1))),a.length>=5&&(y=this.computeRegression(a.slice(-5,-1))),a.length>=4&&(v=this.computeRegression(a.slice(-4,-1)))):(a.length>=5&&(g=this.computeRegression(a)),a.length>=4&&(y=this.computeRegression(a.slice(-4))),a.length>=3&&(v=this.computeRegression(a.slice(-3)))),$=u-o,c=this.getEndOfSprint(u+$),console.log("earliestDataPoint",new Date(o)),console.log("mostRecentDataPoint",new Date(u)),console.log("lastCompleteSprint",new Date(d)),console.log("width: "+($/Duration.DAY).toFixed(1)+" days"),g&&console.log("regAll",new Date(g.x2)),y&&console.log("regLast3",new Date(y.x2)),v&&console.log("regLast2",new Date(v.x2)),f=[],g&&f.push(g.x2),v&&f.push(v.x2),y&&f.push(y.x2),k=function(){var t,e,s;for(s=[],t=0,e=a.length;e>t;t++)n=a[t],s.push(n.day);return s}(),m=f.max())for(p=this.getEndOfSprint(m),p>c&&(p=c),b=_.last(k);p>b;)b=this.nextSprint(b),k.push(b);return e=(new Houston.BurndownChart).days(function(){var t,e,n;for(n=[],t=0,e=k.length;e>t;t++)b=k[t],n.push(new Date(b));return n}()).dateFormat(d3.time.format("%b %e")).totalEffort(C).addLine("completed",a),g&&e.addRegression("all",g),y&&e.addRegression("last-3",y),v&&e.addRegression("last-2",v),e.render(),l=function(){var t,e;return t=d3.select(this),e=t.text().split(/\s+/),t.text(""),t.append("tspan").text(e[0]).attr("class","month"),t.append("tspan").text(e[1]).attr("x",0).attr("dy","11").attr("class","day")},x=d3.select("#graph").select("svg"),x.selectAll(".x.axis text").each(l)},n.prototype.prevSprint=function(t){return 1..week().before(new Date(t)).getTime()},n.prototype.nextSprint=function(t){return 1..week().after(new Date(t)).getTime()},n.prototype.getEndOfSprint=function(t){return+this.getNextFriday(new Date(t))},n.prototype.getNextFriday=function(t){var e,n;return n=t.getDay(),e=5-n,0>e&&(e+=7),e.days().after(t)},n.prototype.truncateDate=function(t){return t=new Date(t),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),+t},n.prototype.computeRegression=function(t){var e,n,a,s,i,r,o,l,d,p,c,u,h,m,f,g,v;for(h=[0,0,0,0,t.length],i=h[0],l=h[1],r=h[2],o=h[3],s=h[4],c=0,u=t.length;u>c;c++)n=t[c],m=[+n.day,n.effort],g=m[0],v=m[1],i+=g,l+=v,r+=g*g,o+=g*v;return a=(s*o-i*l)/(s*r-i*i),e=(l-a*i)/s,0===a?null:(f=[(0-e)/a,0],d=f[0],p=f[1],{x1:new Date(+t[0].day),x2:d,y1:new Date(e+a*+t[0].day),y2:p})},n.prototype.toggleShowCompleted=function(t){var e;return e=$(t.target),e.hasClass("active")?(e.removeClass("btn-success"),this.$el.addClass("hide-completed")):(e.addClass("btn-success"),this.$el.removeClass("hide-completed"))},n}(this.TicketsView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.EditProjectRoadmapView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.resource="milestones",n.prototype.viewPath="houston/roadmap/milestones",n.prototype.sortedBy="startDate",n.prototype.sortOrder="asc",n.prototype.pageSize=1/0,n.prototype.events={"click #show_completed_milestones":"toggleShowCompleted","click #reset_roadmap":"reset","click #save_roadmap":"save"},n.prototype.initialize=function(){return this.projectId=this.options.projectId,this.projectSlug=this.options.projectSlug,this.projectColor=this.options.projectColor,this.milestones=this.collection=this.options.milestones,this.roadmap=new Roadmap.EditRoadmapView(this.milestones,{project:{id:this.projectId,color:this.projectColor},showWeekends:!0,gapWeeks:1}).createMilestone(_.bind(this.createMilestone,this)),this.milestones.bind("change",this.indicateIfRoadmapHasChanged,this),this.milestones.bind("add",this.indicateIfRoadmapHasChanged,this),this.milestones.bind("remove",this.indicateIfRoadmapHasChanged,this),n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.roadmap.render(),this.indicateIfRoadmapHasChanged(),this},n.prototype.indicateIfRoadmapHasChanged=function(){return this.$el.find(".buttons button").prop("disabled",0===this.milestones.changes().length)},n.prototype.createMilestone=function(t,e){var n;return t.projectId=this.projectId,(t.name=prompt("Name:"))?(t.tickets=0,t.ticketsCompleted=0,t.locked=!1,t.completed=!1,n=new Roadmap.Milestone(t),this.milestones.add(n),e()):e()},n.prototype.toggleShowCompleted=function(t){var e;return e=$(t.target),e.hasClass("active")?(e.removeClass("btn-success"),this.$el.addClass("hide-completed")):(e.addClass("btn-success"),this.$el.removeClass("hide-completed"))},n.prototype.reset=function(t){return t.preventDefault(),this.milestones.revert()},n.prototype.save=function(t){var e,n,a;return t.preventDefault(),(a=prompt("Commit message:"))?(e=$("#reset_roadmap, #save_roadmap"),n=this.milestones.changes(),e.prop("disabled",!0),console.log("changes",JSON.stringify(n)),$.put("/roadmap/by_project/"+this.projectSlug,{roadmap:n,message:a}).success(function(t){return function(){return e.prop("disabled",!1),t.milestones.url="/roadmap/by_project/"+t.projectSlug,t.milestones.fetch({reset:!0,parse:!0})}}(this)).error(function(t){var n;return e.prop("disabled",!1),n=Errors.fromResponse(t),n.renderToAlert()})):void 0},n}(Neat.CollectionEditor)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e
}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.EditRoadmapView=function(t){function n(t,e){var a;null==e&&(e={}),this.project=e.project,this.gapWeeks=null!=(a=e.gapWeeks)?a:0,n.__super__.constructor.call(this,t,e),$(document.body).on("keyup",function(t){return function(e){return t.$newMilestone&&t.supportsCreate&&27===e.keyCode?t.cancelCreate():void 0}}(this))}var a;return e(n,t),a=4,n.prototype.$newMilestone=null,n.prototype.newMilestoneX=null,n.prototype.supportsCreate=!1,n.prototype.createMilestone=function(t){return this.supportsCreate=!!t,this._createMilestoneCallback=t,this},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.$el.on("mouseleave",function(t){return function(){return t.cancelCreate()}}(this)),this.$el.on("mouseup",function(t){return function(){var e,n,a,s,i,r,o,l;if(t.$newMilestone&&t.supportsCreate)return r=t.$newMilestone.outerWidth(),r>10?(a=+t.$newMilestone.closest(".roadmap-band").attr("data-band"),i=t.$newMilestone.position().left,o=t.x.invert(i),s=t.x.invert(i+r),n={band:a,lanes:1,startDate:d3.time.monday.round(o),endDate:d3.time.saturday.round(s)},t.$newMilestone.addClass("creating").text("Saving..."),t.$el.removeClass("drag-create"),l=[t.$newMilestone,null],e=l[0],t.$newMilestone=l[1],t._createMilestoneCallback(n,function(){return e.remove()})):t.cancelCreate()}}(this)),this.$el.on("mousemove",function(t){return function(e){var n,a,s,i,r,o;if(t.$newMilestone&&t.supportsCreate)return i=e.screenX-t.newMilestoneX,0>i&&(i=0),a=t.$newMilestone.position().left,r=t.x.invert(a),n=d3.time.saturday.round(t.x.invert(t.$newMilestone.position().left+i)),i=t.x(n)-a,s=n.getTime()-r.getTime()+2*Duration.DAY,o=Math.floor(s/Duration.WEEK),t.$newMilestone.css({width:i}),t.$newMilestone.html(2>o?"&nbsp;":"<span>"+o+"&nbsp;weeks</span>")}}(this))},n.prototype.cancelCreate=function(){return this.$newMilestone&&this.supportsCreate?(this.$el.removeClass("drag-create"),this.$newMilestone.remove(),this.$newMilestone=null):void 0},n.prototype.groupMilestonesIntoBands=function(){var t,e;return t=n.__super__.groupMilestonesIntoBands.apply(this,arguments),e=+d3.max(t,function(t){return t.number})+1,_.isNaN(e)&&(e=1),a>=e&&t.push({key:""+this.project.id+"-"+e,projectId:this.project.id,color:this.project.color,number:e,milestones:[]}),t},n.prototype.initializeBand=function(t){var e;return e=this,$(t).droppable({hoverClass:"sort-active",tolerance:"pointer",over:function(){return e.drag?e.drag.bandOver=+$(this).attr("data-band"):void 0},drop:function(n,a){var s,i,r,o,l,d,p,c,u,h;if(t=+$(this).attr("data-band"),o=a.draggable.attr("data-cid"),l=e.milestones.get(o),l&&(p=d3.time.monday.round(e.x.invert(a.position.left)),a.draggable.css({left:e.x(p)}),i=d3.time.saturday.round(l.duration().after(p)),l.set({band:t,startDate:p,endDate:i}),e.drag&&e.drag.band===e.drag.bandOver)){for(h=[],r=c=0,u=e.drag.milestonesAfter.length;u>=0?u>c:c>u;r=u>=0?++c:--c)l=e.drag.milestonesAfter[r],l.get("locked")?h.push(void 0):(s=$(e.drag.$milestonesAfter[r]),d=s.position().left,p=d3.time.monday.round(e.x.invert(d)),i=d3.time.saturday.round(l.duration().after(p)),h.push(l.set({startDate:p,endDate:i})));return h}}}).on("mousedown",function(t){var n;if(e.supportsCreate&&t.target===this)return e.newMilestoneX=t.screenX,e.$el.addClass("drag-create"),n=d3.time.monday.round(e.x.invert(t.offsetX)),e.$newMilestone=$('<div class="roadmap-milestone-placeholder">&nbsp;</div>').css({left:e.x(n)}).appendTo(this)})},n.prototype.initializeMilestone=function(t){var e;return e=this,$(t).resizable({handles:"e, s, se",animate:!1,start:_.bind(this.onStartDrag,this),resize:function(t,n){var a,s,i,r,o;if(e.drag)return"ui-resizable-s"===e.drag.handle&&(o=(n.originalSize.height+8)/38,s=(n.size.height+8)/38,i=s-o,n.size.width=n.originalSize.width*Math.pow(2,-i),$(this).css({width:n.size.width})),a=n.size.width-n.originalSize.width,e.drag.maxLeft&&(a+=e.drag.originalLeft-e.drag.maxLeft,0>a&&(a=0)),r=n.position.left+n.size.width,e.drag.$milestonesAfter.each(function(t){var n;return n=e.drag.milestonesAfterPositions[t],a>0&&!$(this).hasClass("locked")&&(n=Math.max(n+a,r+e.drag.minGap)),$(this).css({left:n}),r=n+$(this).outerWidth()})},stop:function(n,a){var s,i,r,o,l,d,p,c,u,h;if(a.element.resizable("option","grid",!1),a.element.draggable("option","grid",!1),o=a.element.attr("data-cid"),t=e.milestones.get(o),t&&(i=d3.time.saturday.round(e.x.invert(a.position.left+a.size.width)),a.element.css({width:e.x(i)-a.element.position().left}),l=(a.size.height+8)/38,t.set({endDate:i,lanes:l}),e.drag)){for(h=[],r=c=0,u=e.drag.milestonesAfter.length;u>=0?u>c:c>u;r=u>=0?++c:--c)t=e.drag.milestonesAfter[r],t.get("locked")?h.push(void 0):(s=$(e.drag.$milestonesAfter[r]),d=s.position().left,p=d3.time.monday.round(e.x.invert(d)),i=d3.time.saturday.round(t.duration().after(p)),h.push(t.set({startDate:p,endDate:i})));return h}}}).draggable({snap:".roadmap-band",snapMode:"inner",zIndex:10,revertDuration:150,start:_.bind(this.onStartDrag,this),drag:function(t,n){var a,s;if(e.drag)return e.drag.band===e.drag.bandOver?(n.position.left=Math.max(n.position.left,e.drag.minLeft),a=n.position.left-e.drag.offsetLeft,e.drag.maxLeft&&(a+=e.drag.originalLeft-e.drag.maxLeft,0>a&&(a=0))):a=0,s=n.position.left+n.helper.outerWidth(),e.drag.$milestonesAfter.each(function(t){var n;return n=e.drag.milestonesAfterPositions[t],a>0&&!$(this).hasClass("locked")&&(n=Math.max(n+a,s+e.drag.minGap)),$(this).css({left:n}),s=n+$(this).outerWidth()})},stop:function(t){return e.drag=null,$(t.target).resizable("option","grid",!1),$(t.target).draggable("option","grid",!1)},revert:function(t){return!t||!t.is(".roadmap-band")}})},n.prototype.onStartDrag=function(t,e){var n,a,s,i,r,o,l,d,p,c,u,h,m,f,g,v,y,w;if(l=$(t.originalEvent.target).attr("class"),l&&(l=l.split(" ")[1]),n=$(t.target),n.hasClass("locked"))return!1;for(s=+n.closest(".roadmap-band").attr("data-band"),d=n.attr("data-cid"),c=this.milestones.get(d),v=c.get("startDate"),r=c.get("endDate"),i=Math.floor((r-v)/Duration.DAY).days(),m=this.milestones.where({band:s}),f=null,p=null,u=[],o=[this.weekWidth(),this.bandHeight()],n.resizable("option","grid",o),n.draggable("option","grid",o),y=0,w=m.length;w>y;y++)c=m[y],c.get("startDate")&&c.get("endDate")&&(c.get("endDate")<v?f=2..days().after(c.get("endDate")):c.get("startDate")>r&&(p||(p=i.before(2..days().before(c.get("startDate")))),u.push(c)));return g=_.map(u,function(t){return".roadmap-milestone[data-cid="+t.cid+"]"}),a=this.$el.find(g.join(", ")),h=a.map(function(){return $(this).position().left}),this.drag={milestone:c,band:s,minLeft:f?this.x(f):0,maxLeft:p?this.x(p):0,milestonesAfter:u,$milestonesAfter:a,milestonesAfterPositions:h,offsetLeft:e.position.left,originalLeft:n.position().left,handle:l,minGap:this.minGap()}},n.prototype.bandHeight=function(){return 38},n.prototype.weekWidth=function(){var t,e;return t=(e=d3.time).saturdays.apply(e,this.x.domain())[0],this.x(7..days().after(t))-this.x(t)},n.prototype.minGap=function(){var t,e,n,a;return t=(a=d3.time).saturdays.apply(a,this.x.domain())[0],n=this.x(2..days().after(t))-this.x(t),e=this.x(7..days().after(t))-this.x(t),n+e*this.gapWeeks},n}(Roadmap.RoadmapView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};window.MilestoneView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="tr",n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.$el.attr("data-cid",this.model.cid),this.$el.toggleClass("new",!this.model.get("id")),this.$el.toggleClass("locked",this.model.get("locked")),this.$el.toggleClass("completed",this.model.get("completed")),this},n}(Neat.ModelEditor)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.ShowProjectRoadmapView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click #show_completed_milestones":"toggleShowCompleted"},n.prototype.initialize=function(){return this.projectId=this.options.projectId,this.milestones=this.options.milestones,this.template=HandlebarsTemplates["houston/roadmap/show"],this.roadmap=new Roadmap.RoadmapView(this.milestones,this.options),n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){return this.$el.html(this.template({milestones:this.milestones.toJSON()})),this.roadmap.render(),this},n.prototype.toggleShowCompleted=function(t){var e;return e=$(t.target),e.hasClass("active")?(e.removeClass("btn-success"),this.$el.addClass("hide-completed")):(e.addClass("btn-success"),this.$el.removeClass("hide-completed"))},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function a(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return a.prototype=n.prototype,e.prototype=new a,e.__super__=n.prototype,e};Roadmap.ShowRoadmapView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return this.setMilestones(this.options.milestones)},n.prototype.setMilestones=function(t){return this.milestones=t,this.roadmap=new Roadmap.RoadmapView(this.milestones,this.options),this},n.prototype.render=function(){return this.roadmap.render(),this},n}(Backbone.View)}.call(this),function(){Roadmap.ThumbnailRoadmapView=function(){function t(t){this.milestones=t.milestones,this.parent=t.parent,this.viewport=t.viewport,this.milestones.bind("add",this.update,this),this.milestones.bind("remove",this.update,this),this.milestones.bind("change",this.update,this),this.milestones.bind("reset",this.update,this),$(window).resize(function(t){return function(e){return e.target===window?t.updateWindow():void 0}}(this))}return t.prototype.render=function(){var t,e,n;return this.height=46,this.graphHeight=this.height-18,t=this.parent.append("div").attr("style","position: relative; height: "+this.height+"px;"),e=t.append("svg").attr("height",this.height).attr("class","roadmap-thumbnail").append("g").attr("transform","translate(0,0)"),this.roadmap=e.append("g").attr("class","roadmap-bands"),this.viewer=t.selectAll(".roadmap-thumbnail-viewer").data([this.viewport]),n=this,this.viewer.enter().append("div").attr("class","roadmap-thumbnail-viewer").attr("style","top: 1px; height: "+(this.height-2)+"px; left: 1px;").each(function(){return $(this).draggable({axis:"x",containment:"parent",drag:function(t,e){var a,s,i;return i=n.x.invert(e.position.left),s=i-n.viewport.get("start"),a=new Date(+n.viewport.get("end")+s),n.viewport.set({start:i,end:a})}}).resizable({handles:"e",containment:"parent",resize:function(t,e){var a;return a=n.x.invert(e.position.left+e.size.width),n.viewport.set({end:a})}})}),this.xAxis=e.append("g").attr("class","x axis").attr("transform","translate(0,"+this.graphHeight+")"),this.updateWindow()},t.prototype.updateWindow=function(){var t;return t=$("#roadmap").width()||960,this.width!==t?(this.width=t,this.parent.select(".roadmap-thumbnail").transition(150).attr("width",this.width),this.update()):void 0},t.prototype.update=function(){var t,e,n,a,s;return s=_.select(this.milestones.toJSON(),function(t){return t.startDate&&t.endDate}),s.length>0?(this.startDate=3..weeks().before(d3.min(s,function(t){return t.startDate})),this.endDate=12..weeks().after(d3.max(s,function(t){return t.endDate}))):(this.startDate=3..weeks().ago(),this.endDate=12..weeks().fromNow()),this.viewport.get("start")<this.startDate&&(this.startDate=this.viewport.get("start")),this.viewport.get("end")>this.endDate&&(this.endDate=this.viewport.get("end")),this.x=d3.time.scale().domain([this.startDate,this.endDate]).range([0,this.width]),a=d3.svg.axis().scale(this.x).orient("bottom").innerTickSize(4),this.xAxis.transition(150).call(a),this.viewer.attr("style",function(t){return function(e){return"top: 1px; height: "+(t.height-2)+"px; left: "+t.x(e.get("start"))+"px; width: "+(t.x(e.get("end"))-t.x(e.get("start")))+"px;"}}(this)),e=d3.nest().key(function(t){return t.band}).entries(s),t=this.roadmap.selectAll(".roadmap-thumbnail-band").data(e,function(t){return t.key}),t.enter().append("g").attr("class","roadmap-thumbnail-band").attr("transform",function(t,e){return"translate(0,"+(2+6*e)+")"}),t.exit().remove(),n=t.selectAll(".roadmap-thumbnail-milestone").data(function(t){return t.values},function(t){return t.cid}),n.attr("class",function(t){var e;return e=["roadmap-thumbnail-milestone"],t.completed&&e.push("completed"),e.join(" ")}).transition(150).attr("height",function(t){return 6*t.lanes-1}).attr("width",function(t){return function(e){return t.x(e.endDate)-t.x(e.startDate)}}(this)).attr("x",function(t){return function(e){return t.x(e.startDate)}}(this)),n.enter().append("rect").attr("rx",1).attr("ry",1).attr("height",function(t){return 6*t.lanes-1}).attr("width",function(t){return function(e){return t.x(e.endDate)-t.x(e.startDate)}}(this)).attr("x",function(t){return function(e){return t.x(e.startDate)}}(this)).attr("class",function(t){var e;return e=["roadmap-thumbnail-milestone"],t.completed&&e.push("completed"),e.join(" ")}),n.exit().remove()},t}()}.call(this);