(function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["houston/alerts/show"]=Handlebars.template({1:function(t,e,n,r,a){var l,s='      <select class="houston-alert-project">\n        <option value="" ';return l=e.unless.call(t,null!=t?t.projectId:t,{name:"unless",hash:{},fn:this.program(2,r,a),inverse:this.noop,data:r}),null!=l&&(s+=l),s+="></option>\n",l=e.each.call(t,null!=t?t.projects:t,{name:"each",hash:{},fn:this.program(4,r,a),inverse:this.noop,data:r}),null!=l&&(s+=l),s+"      </select>\n"},2:function(){return"selected"},4:function(t,e,n,r,a){var l,s,o="function",i=e.helperMissing,u=this.escapeExpression,c='          <option value="'+u((s=null!=(s=e.id||(null!=t?t.id:t))?s:i,typeof s===o?s.call(t,{name:"id",hash:{},data:r}):s))+'" ';return l=(e.ifEql||t&&t.ifEql||i).call(t,null!=t?t.id:t,null!=a[1]?a[1].projectId:a[1],{name:"ifEql",hash:{},fn:this.program(2,r,a),inverse:this.noop,data:r}),null!=l&&(c+=l),c+">"+u((s=null!=(s=e.name||(null!=t?t.name:t))?s:i,typeof s===o?s.call(t,{name:"name",hash:{},data:r}):s))+"</option>\n"},6:function(t,e,n,r){var a,l="      ";return a=e["if"].call(t,null!=t?t.projectSlug:t,{name:"if",hash:{},fn:this.program(7,r),inverse:this.noop,data:r}),null!=a&&(l+=a),l+"\n"},7:function(t,e,n,r){var a,l="function",s=e.helperMissing,o=this.escapeExpression;return'<b class="label '+o((a=null!=(a=e.projectColor||(null!=t?t.projectColor:t))?a:s,typeof a===l?a.call(t,{name:"projectColor",hash:{},data:r}):a))+'">'+o((a=null!=(a=e.projectSlug||(null!=t?t.projectSlug:t))?a:s,typeof a===l?a.call(t,{name:"projectSlug",hash:{},data:r}):a))+"</b>"},9:function(){return"disabled"},11:function(t,e,n,r,a){var l,s,o="function",i=e.helperMissing,u=this.escapeExpression,c='        <option value="'+u((s=null!=(s=e.id||(null!=t?t.id:t))?s:i,typeof s===o?s.call(t,{name:"id",hash:{},data:r}):s))+'" ';return l=(e.ifEql||t&&t.ifEql||i).call(t,null!=t?t.id:t,null!=(l=null!=a[1]?a[1].checkedOutBy:a[1])?l.id:l,{name:"ifEql",hash:{},fn:this.program(2,r,a),inverse:this.noop,data:r}),null!=l&&(c+=l),c+">"+u((s=null!=(s=e.name||(null!=t?t.name:t))?s:i,typeof s===o?s.call(t,{name:"name",hash:{},data:r}):s))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,r,a){var l,s,o="function",i=e.helperMissing,u=this.escapeExpression,c=this.lambda,h='<tr id="alert_'+u((s=null!=(s=e.id||(null!=t?t.id:t))?s:i,typeof s===o?s.call(t,{name:"id",hash:{},data:r}):s))+'" class="houston-alert" rel="alert" data-location="'+u((s=null!=(s=e.url||(null!=t?t.url:t))?s:i,typeof s===o?s.call(t,{name:"url",hash:{},data:r}):s))+'" data-id="'+u((s=null!=(s=e.id||(null!=t?t.id:t))?s:i,typeof s===o?s.call(t,{name:"id",hash:{},data:r}):s))+'">\n  <td class="table-margin"></td>\n  <td class="houston-alert-type" data-sort-by="'+u((s=null!=(s=e.type||(null!=t?t.type:t))?s:i,typeof s===o?s.call(t,{name:"type",hash:{},data:r}):s))+'">';return l=(e.iconForAlert||t&&t.iconForAlert||i).call(t,null!=t?t.type:t,{name:"iconForAlert",hash:{},data:r}),null!=l&&(h+=l),h+='</td>\n  <td class="houston-alert-project">\n',l=e["if"].call(t,null!=t?t.canChangeProject:t,{name:"if",hash:{},fn:this.program(1,r,a),inverse:this.program(6,r,a),data:r}),null!=l&&(h+=l),h+='  </td>\n  <td class="houston-alert-summary">'+u((s=null!=(s=e.summary||(null!=t?t.summary:t))?s:i,typeof s===o?s.call(t,{name:"summary",hash:{},data:r}):s))+'</td>\n  <td class="houston-alert-deadline date">',l=(e.formatDateWithYear||t&&t.formatDateWithYear||i).call(t,null!=t?t.deadline:t,{name:"formatDateWithYear",hash:{},data:r}),null!=l&&(h+=l),h+='</td>\n  <td class="houston-alert-worker" data-sort-by="'+u(c(null!=(l=null!=t?t.checkedOutBy:t)?l.name:l,t))+'">\n    <select class="houston-alert-assign" ',l=e["if"].call(t,null!=t?t.checkedOutRemotely:t,{name:"if",hash:{},fn:this.program(9,r,a),inverse:this.noop,data:r}),null!=l&&(h+=l),h+='>\n      <option value="" ',l=e.unless.call(t,null!=t?t.checkedOutBy:t,{name:"unless",hash:{},fn:this.program(2,r,a),inverse:this.noop,data:r}),null!=l&&(h+=l),h+="></option>\n",l=e.each.call(t,null!=t?t.workers:t,{name:"each",hash:{},fn:this.program(11,r,a),inverse:this.noop,data:r}),null!=l&&(h+=l),h+'    </select>\n  </td>\n  <td class="table-margin"></td>\n</tr>'},useData:!0,useDepths:!0}),this.HandlebarsTemplates["houston/alerts/show"]}).call(this),function(){Houston.Alerts=Houston.Alerts||{}}.call(this),function(){var t;t={itsm:"fa-fire-extinguisher",cve:"fa-bank",ue:"fa-bug"},Handlebars.registerHelper("iconForAlert",function(e){var n,r;return n=t[e],r=24,'<img src="/images/'+n+'.svg" width="'+2*r+'" height="'+2*r+'" style="width: '+r+"px; height: "+r+'px;" />'}),Handlebars.registerHelper("ifEql",function(t,e,n){return t===e?n.fn(this):void 0})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var a in n)t.call(n,a)&&(e[a]=n[a]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Houston.Alerts.Alert=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="/alerts/alerts",n}(Backbone.Model),Houston.Alerts.Alerts=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Houston.Alerts.Alert,n}(Backbone.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var a in n)t.call(n,a)&&(e[a]=n[a]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Houston.Alerts.AlertsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"change select.houston-alert-assign":"assignAlert","change select.houston-alert-project":"setAlertProject"},n.prototype.initialize=function(){return this.renderAlert=HandlebarsTemplates["houston/alerts/show"],this.alerts=this.options.alerts,this.workers=this.options.workers,this.projects=this.options.projects,this.$el.on("click",'[rel="alert"]',function(){return function(t){var e;if(!$(t.target).is("select, a, button, input"))return t.preventDefault(),t.stopImmediatePropagation(),e=$(t.target).closest('[rel="alert"]').attr("data-location"),window.open(e)}}(this))},n.prototype.render=function(){var t,e,n,r;for(this.$el.empty(),r=this.alerts.toJSON(),e=0,n=r.length;n>e;e++)t=r[e],this.$el.append(this.renderAlert(_.extend(t,{workers:this.workers,projects:this.projects})));return $(".table-sortable").tablesorter({headers:{1:{sorter:"attr"},5:{sorter:"attr"}}})},n.prototype.assignAlert=function(t){var e,n;return e=$(t.target),n=e.closest(".houston-alert").attr("data-id"),$.put("/alerts/"+n,{checked_out_by_id:e.val()})},n.prototype.setAlertProject=function(t){var e,n;return e=$(t.target),n=e.closest(".houston-alert").attr("data-id"),$.put("/alerts/"+n,{project_id:e.val()})},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var a in n)t.call(n,a)&&(e[a]=n[a]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Houston.Alerts.ReportsView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.initialize=function(){var t,e,n,r;for(this.alerts=this.options.alerts,r=this.alerts,e=0,n=r.length;n>e;e++)t=r[e],t.hours=+t.hours,t.closed=new Date(t.closed),t.closedDate=App.truncatedDate(t.closed),t.opened=new Date(t.opened),t.deadline=new Date(t.deadline),t.onTime=t.closed<t.deadline,t.week=this.getBeginningOfWeek(t.closed),t.weekOpened=this.getBeginningOfWeek(t.opened);return this.alerts=_.sortBy(this.alerts,"closed")},r.prototype.render=function(){var t,e,r,a,l,s,o;return this.$el.html('<h3>Hours Spent on Alerts by Type</h3>\n<div id="alert_time_by_type" class="graph"></div>\n\n<h3>Alerts by Project</h3>\n<table class="alerts-by-project">\n  <thead>\n    <tr>\n      <th class="invisible"></th>\n      <th colspan="3">Number Opened</th>\n      <th colspan="3">Hours Spent</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>CVEs</th>\n      <th>ITSMs</th>\n      <th>Exceptions</th>\n      <th>CVEs</th>\n      <th>ITSMs</th>\n      <th>Exceptions</th>\n    </tr>\n  </thead>\n  <tbody id="alerts_by_project_and_type"></tbody>\n</table>'),s=["cve","itsm","ue"],e=d3.nest().key(function(t){return t.week}).entries(this.alerts).map(function(t){var e,n,r,a,l,s;for(r=new Date(t.key),n={cve:0,itsm:0,ue:0},s=t.values,a=0,l=s.length;l>a;a++)e=s[a],n[e.type]+=e.hours;return[r,n.cve,n.itsm,n.ue]}),(new Houston.StackedAreaGraph).selector(this.$el.find("#alert_time_by_type")[0]).labels(s).data(e).render(),o=e.map(function(t){var e,r;return r=t[0],e=2<=t.length?n.call(t,1):[],r}),r=0,a=0,t=d3.nest().key(function(t){return t.projectSlug}).entries(this.alerts).map(function(t){var e,n,l,i,u,c,h;return c=function(){var c,p,d;for(d=[],c=0,p=s.length;p>c;c++)u=s[c],l=function(){var n,a,l;for(l=[],n=0,a=o.length;a>n;n++)h=o[n],e=_.select(t.values,function(t){return _.isEqual(t.weekOpened,h)&&t.type===u}),i=e.length,r=d3.max([i,r]),l.push([h,i]);return l}(),n=function(){var n,r,l;for(l=[],n=0,r=o.length;r>n;n++)h=o[n],e=_.select(t.values,function(t){return _.isEqual(t.week,h)&&t.type===u}),i=d3.sum(e,function(t){return t.hours}),a=d3.max([i,a]),l.push([h,i]);return l}(),d.push({key:u,opened:l,closed:n});return d}(),{key:t.key,values:c}}),l=d3.select("#alerts_by_project_and_type").selectAll("tr").data(t).enter().append("tr"),l.append("th").text(function(t){return t.key}),l.selectAll(".opened").data(function(t){return t.values}).enter().append("td").attr("class","opened").each(function(t){var e;return e=(new Houston.StackedBarGraph).selector(this).legend(!1).labels(["Count"]).colors(["rgb(243, 101, 66)"]).range([0,r]).width(108).height(40).margin({top:0,left:24,right:0,bottom:0}).data(t.opened).yTicks([5,10]).render()}),l.selectAll(".closed").data(function(t){return t.values}).enter().append("td").attr("class","closed").each(function(t){var e;return e=(new Houston.StackedBarGraph).selector(this).legend(!1).labels(["Count"]).colors(["rgb(31, 138, 180)"]).range([0,a]).width(108).height(40).margin({top:0,left:24,right:0,bottom:0}).data(t.closed).yTicks([2,4,6]).render()})},r.prototype.getBeginningOfWeek=function(t){var e,n;return n=t.getDay(),e=n-1,0>e&&(e+=7),e.days().before(t)},r}(Backbone.View)}.call(this);