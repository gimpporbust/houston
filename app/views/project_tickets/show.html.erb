<%= render partial: "projects/header", locals: {project: @project, subtitle: "Ticket"} %>

<div class="ticket ticket-page" id="ticket_view">
  <h2>
    <span class="ticket-number">#<%= @ticket.number %></span>
    <span class="ticket-summary editable" id="ticket_summary">
      <span class="show"><%= @ticket.summary %></span>
      <span class="edit"><input type="text" name="summary" /></span>
    </span>
  </h2>

  <% if @ticket.closed? %>
    <div class="ticket-state closed">
      <i class="icon icon-ban-circle"></i> Closed
    </div>
  <% else %>
    <div class="ticket-state open">
      <i class="icon icon-circle-blank"></i> Open
    </div>
  <% end %>

  <div class="ticket-reporter">
    Opened by
    <b><%= @ticket.reporter.name %></b>
    <span class="ticket-opened"><%= time_ago_in_words @ticket.created_at %> ago</span>
  </div>

  <hr />

  <div class="ticket-description editable" id="ticket_description">
    <div class="show"><%= mdown @ticket.description %></div>
    <div class="edit">
      <textarea name="description"></textarea>
      <p class="buttons">
        <button type="reset" class="btn btn-link">Cancel</button>
        <button type="submit" class="btn btn-default">Save</button>
      </p>
    </div>
  </div>


  <div class="buttons">
    <% if @ticket.closed? %>
      <%= form_tag reopen_ticket_path(slug: @project.slug, number: @ticket.number) do %>
        <button type="submit" class="btn btn-success">Reopen</button>
      <% end %>
    <% else %>
      <%= form_tag close_ticket_path(slug: @project.slug, number: @ticket.number) do %>
        <button type="submit" class="btn btn-danger">Close</button>
      <% end %>
    <% end %>
</div>

<% content_for :javascripts do %>
  <script type="text/javascript">
    $(function() {
      new EditTicketView({
        el: document.getElementById('ticket_view'),
        ticket: new Ticket(<%=raw({
          id: @ticket.id,
          summary: @ticket.summary,
          description: @ticket.description
        }.to_json) %>)
      }).render();
    });
  </script>
<% end %>
